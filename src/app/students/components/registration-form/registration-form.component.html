<app-header-student></app-header-student>

<app-status
  *ngIf="!newRegistration"
  (startNewRegistartion)="toggleNewRegistartion($event)"
></app-status>

<div class="registration-container" *ngIf="newRegistration">
  <div class="registration-header">
    <div class="main-header">
      <div
        class="breadcrumb-divider"
        *ngIf="!hasQueryParams"
        (click)="toggleNewRegistartion(false)"
      >
        ❮
      </div>
      <h1>JLPT Registration</h1>
    </div>
    <p class="subtitle">
      Japanese Language Proficiency Test - {{ currentTerm }}
    </p>
  </div>
  <div class="registration-progress">
    <div class="progress-bar">
      <div class="progress-fill" [style.width.%]="calculateProgress()"></div>
    </div>
    <span class="progress-text">{{ calculateProgress() }}% Complete</span>
  </div>
  <!-- Breadcrumb Navigation -->
  <div class="breadcrumb">
    <ng-container *ngFor="let phase of phases; let i = index">
      <div
        class="breadcrumb-item"
        [ngClass]="{
          active: currentPhase === phase.id,
          completed: isPhaseCompleted(phase.id),
          disabled: !isPhaseAccessible(phase.id)
        }"
        (click)="navigateToPhase(phase.id)"
      >
        <span class="phase-number">{{ i + 1 }}</span>
        <span class="phase-name">{{ phase.name }}</span>
        <span class="checkmark" *ngIf="isPhaseCompleted(phase.id)">✓</span>
      </div>
      <div class="breadcrumb-divider" *ngIf="i < phases.length - 1">›</div>
    </ng-container>
  </div>

  <!-- Phase Content -->
  <div class="phase-content">
    <ng-container [ngSwitch]="currentPhase">
      <!-- Important Notes Phase -->
      <div *ngSwitchCase="'important-notes'" class="phase-important-notes">
        <h2>Important Notes Before Registration</h2>
        <div class="notes-list">
          <div class="note-item" *ngFor="let note of importantNotes">
            <span class="note-icon">⚠️</span>
            <p>{{ note }}</p>
          </div>
        </div>
        <h2>Steps to Follow</h2>
        <div class="notes-list">
          <div class="note-item" *ngFor="let note of stepsToFollow">
            <span class="note-icon"> ✅ </span>
            <p>{{ note }}</p>
          </div>
        </div>
        <div class="action-buttons">
          <button
            class="next-button"
            (click)="completePhase('important-notes')"
          >
            I Understand - Proceed to Registration
          </button>
        </div>
      </div>

      <!-- Registration Form Phase -->
      <div class="registration-form" *ngSwitchCase="'registration-form'">
        <h2>Registration Form</h2>
        <p class="form-description">
          Please fill in all required details for JLPT registration
        </p>

        <form [formGroup]="registrationForm">
          <button type="button" class="action-buttons" (click)="saveProgress()">
            Save Progress
          </button>
          <!-- Special Arrangements Section -->
          <div class="form-section">
            <h3 class="section-title">
              <span class="english">Special Arrangements</span>
              <span class="japanese">特別な配慮</span>
            </h3>
            <div class="form-field">
              <label>
                <input type="checkbox" formControlName="specialArrangement" />
                Request Special Arrangement
                <span
                  class="tooltip-icon"
                  [matTooltip]="specialArrangementTooltip"
                  >?</span
                >
              </label>
            </div>
          </div>

          <!-- Test Level Section -->
          <div class="form-section">
            <h3 class="section-title">
              <span class="english">Test Information</span>
              <span class="japanese">試験情報</span>
            </h3>

            <div class="form-field">
              <label>
                Test Level
                <span class="tooltip-icon" [matTooltip]="testLevelTooltip"
                  >?</span
                >
              </label>
              <select formControlName="testLevel" required>
                <option *ngFor="let level of jlptLevels" [value]="level.value">
                  {{ level.label }}
                </option>
              </select>
              <span
                class="error-message"
                *ngIf="registrationForm.get('testLevel')?.hasError('required')"
              >
                Test level is required
              </span>
            </div>

            <div class="form-field">
              <label>
                Test Site
                <span class="tooltip-icon" [matTooltip]="testSiteTooltip"
                  >?</span
                >
              </label>
              <input type="text" formControlName="testSite" readonly />
            </div>
          </div>

          <!-- Personal Details Section -->
          <div class="form-section">
            <h3 class="section-title">
              <span class="english">Personal Details</span>
              <span class="japanese">個人情報</span>
            </h3>

            <div class="form-field">
              <label>
                Full Name (English characters only)
                <span class="tooltip-icon" [matTooltip]="nameTooltip">?</span>
              </label>
              <div class="name-fields">
                <input
                  type="text"
                  formControlName="firstName"
                  placeholder="First Name"
                  maxlength="40"
                  (input)="validateName($event.target, 'firstName')"
                />
                <input
                  type="text"
                  formControlName="middleName"
                  placeholder="Middle Name"
                  maxlength="40"
                  (input)="validateName($event.target, 'middleName')"
                />
                <input
                  type="text"
                  formControlName="lastName"
                  placeholder="Last Name"
                  maxlength="40"
                  (input)="validateName($event.target, 'lastName')"
                />
              </div>
              <span
                class="error-message"
                *ngIf="registrationForm.get('firstName')?.hasError('pattern')"
              >
                Only English letters (a-z) are allowed
              </span>
            </div>

            <div class="form-field">
              <label>
                SEQ
                <span class="tooltip-icon" [matTooltip]="passcodeTooltip"
                  >?</span
                >
              </label>
              <input type="text" formControlName="regSeq" maxlength="4" />
            </div>

            <div class="form-field">
              <label>
                Gender
                <span class="tooltip-icon" [matTooltip]="genderTooltip">?</span>
              </label>
              <select formControlName="gender" required>
                <option value="male">Male</option>
                <option value="female">Female</option>
                <option value="na">N/A</option>
              </select>
            </div>

            <div class="form-field">
              <label>
                Native Language
                <span class="tooltip-icon" [matTooltip]="nativeLanguageTooltip"
                  >?</span
                >
              </label>
              <mat-form-field appearance="outline">
                <!-- <mat-label>Select Language</mat-label> -->
                <input
                  type="text"
                  matInput
                  formControlName="nativeLanguage"
                  [matAutocomplete]="auto"
                />
                <mat-autocomplete #auto="matAutocomplete">
                  <mat-option
                    *ngFor="let language of languages"
                    [value]="language.value"
                  >
                    {{ language.label }}
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
            </div>

            <div class="form-field">
              <label>
                8-digit Passcode (Numbers only)
                <span class="tooltip-icon" [matTooltip]="passcodeTooltip"
                  >?</span
                >
              </label>
              <input
                type="password"
                formControlName="passcode"
                maxlength="8"
                (input)="validatePasscode($event.target)"
              />
              <span
                class="error-message"
                *ngIf="registrationForm.get('passcode')?.hasError('pattern')"
              >
                Must be 8 digits (0-9)
              </span>
            </div>

            <div class="form-field">
              <label>
                Date of Birth
                <span class="tooltip-icon" [matTooltip]="dobTooltip">?</span>
              </label>
              <mat-form-field appearance="outline">
                <input
                  matInput
                  [matDatepicker]="picker"
                  formControlName="dob"
                  required
                />
                <mat-datepicker-toggle
                  matSuffix
                  [for]="picker"
                ></mat-datepicker-toggle>
                <mat-datepicker #picker></mat-datepicker>
              </mat-form-field>
              <span
                class="error-message"
                *ngIf="registrationForm.get('dob')?.hasError('required')"
              >
                Date of birth is required
              </span>
            </div>
          </div>

          <!-- Address Section -->
          <div class="form-section">
            <h3 class="section-title">
              <span class="english">Address</span>
              <span class="japanese">住所</span>
            </h3>

            <div class="form-field">
              <label>
                House/Apt/Street
                <span class="tooltip-icon" [matTooltip]="address1Tooltip"
                  >?</span
                >
              </label>
              <input type="text" formControlName="address1" required />
            </div>

            <div class="form-field">
              <label>
                City/State
                <span class="tooltip-icon" [matTooltip]="address2Tooltip"
                  >?</span
                >
              </label>
              <input type="text" formControlName="address2" required />
            </div>

            <div class="form-field">
              <label>
                Country
                <span class="tooltip-icon" [matTooltip]="countryTooltip"
                  >?</span
                >
              </label>
              <input type="text" formControlName="country" required />
            </div>

            <div class="form-field">
              <label>
                Pincode
                <span class="tooltip-icon" [matTooltip]="pincodeTooltip"
                  >?</span
                >
              </label>
              <input type="text" formControlName="pincode" required />
            </div>
          </div>

          <!-- Mailing Address Section -->
          <div class="form-section">
            <h3 class="section-title">
              <span class="english">Mailing Address</span>
              <span class="japanese">郵送先住所</span>
            </h3>
            <div class="form-field">
              <label>
                <input type="checkbox" formControlName="sameAsAddress" />
                Same as residential address
                <span class="tooltip-icon" [matTooltip]="mailingAddressTooltip"
                  >?</span
                >
              </label>
            </div>

            <div *ngIf="!registrationForm.get('sameAsAddress')?.value">
              <!-- Repeat address fields for mailing address -->
            </div>
          </div>

          <!-- Other Details Section -->
          <div class="form-section">
            <h3 class="section-title">
              <span class="english">Other Details</span>
              <span class="japanese">その他の詳細</span>
            </h3>

            <!-- Institution Studying Japanese -->
            <div class="form-field">
              <label>
                Institution Studying Japanese
                <span class="tooltip-icon" [matTooltip]="institutionTooltip"
                  >?</span
                >
              </label>
              <input type="text" formControlName="institution" />
            </div>

            <!-- Place of Learning Japanese -->
            <div class="form-field">
              <label>
                Place of Learning Japanese
                <span class="tooltip-icon" [matTooltip]="learningPlaceTooltip"
                  >?</span
                >
              </label>
              <select formControlName="learningPlace">
                <option
                  *ngFor="let place of learningPlaces"
                  [value]="place.value"
                >
                  {{ place.label }}
                </option>
              </select>
            </div>

            <!-- Reason for Taking Exam -->
            <div class="form-field">
              <label>
                Reason for Taking This Exam
                <span class="tooltip-icon" [matTooltip]="examReasonTooltip"
                  >?</span
                >
              </label>
              <select formControlName="examReason">
                <option
                  *ngFor="let reason of examReasons"
                  [value]="reason.value"
                >
                  {{ reason.label }}
                </option>
              </select>
            </div>

            <!-- Occupation -->
            <div class="form-field">
              <label>
                Occupation
                <span class="tooltip-icon" [matTooltip]="occupationTooltip"
                  >?</span
                >
              </label>
              <select
                formControlName="occupation"
                (change)="onOccupationChange()"
              >
                <option
                  *ngFor="let occupation of occupations"
                  [value]="occupation.value"
                >
                  {{ occupation.label }}
                </option>
              </select>
            </div>

            <!-- Occupational Details (conditional) -->
            <div class="form-field" *ngIf="showOccupationalDetails">
              <label>
                Occupational Details
                <span
                  class="tooltip-icon"
                  [matTooltip]="occupationalDetailsTooltip"
                  >?</span
                >
              </label>
              <select formControlName="occupationalDetails">
                <option
                  *ngFor="let detail of occupationalDetails"
                  [value]="detail.value"
                >
                  {{ detail.label }}
                </option>
              </select>
            </div>

            <!-- Japanese Media Contact -->
            <div class="form-field">
              <label>
                Media via which you came into contact with Japanese Language
                <span class="tooltip-icon" [matTooltip]="mediaContactTooltip"
                  >?</span
                >
              </label>
              <div class="checkbox-group">
                <div
                  *ngFor="let media of mediaContacts"
                  class="checkbox-option"
                >
                  <label>
                    <input
                      type="checkbox"
                      [value]="media.value"
                      (change)="onMediaContactChange($event, media.value)"
                    />
                    {{ media.label }}
                  </label>
                </div>
              </div>
            </div>

            <!-- Japanese Communication -->
            <div class="form-field">
              <label>
                The person with whom you usually communicate in Japanese
                <span class="tooltip-icon" [matTooltip]="communicationTooltip"
                  >?</span
                >
              </label>
              <div class="communication-grid">
                <div class="header"></div>
                <div class="header">Speaking</div>
                <div class="header">Listening</div>
                <div class="header">Reading</div>
                <div class="header">Writing</div>

                <div
                  *ngFor="let person of communicationPersons"
                  class="person-row"
                >
                  <div class="person-label">{{ person.label }}</div>
                  <div class="checkbox-cell">
                    <input
                      type="checkbox"
                      (change)="
                        onCommunicationChange($event, person.id, 'speaking')
                      "
                    />
                  </div>
                  <div class="checkbox-cell">
                    <input
                      type="checkbox"
                      (change)="
                        onCommunicationChange($event, person.id, 'listening')
                      "
                    />
                  </div>
                  <div class="checkbox-cell">
                    <input
                      type="checkbox"
                      (change)="
                        onCommunicationChange($event, person.id, 'reading')
                      "
                    />
                  </div>
                  <div class="checkbox-cell">
                    <input
                      type="checkbox"
                      (change)="
                        onCommunicationChange($event, person.id, 'writing')
                      "
                    />
                  </div>
                </div>
              </div>
            </div>

            <!-- Previous JLPT Attempts -->
            <div class="form-field">
              <label>
                Previous JLPT Attempts
                <span
                  class="tooltip-icon"
                  [matTooltip]="previousAttemptsTooltip"
                  >?</span
                >
              </label>

              <div class="attempts-table" formArrayName="attempts">
                <div class="table-header">
                  <div>Level</div>
                  <div>Times Taken</div>
                  <div>Last Attempt Result</div>
                </div>

                <div
                  *ngFor="let group of attemptsArray.controls; let i = index"
                  [formGroupName]="i"
                  class="table-row"
                >
                  <div>{{ group.value.level }}</div>
                  <div>
                    <input type="number" min="0" formControlName="attempts" />
                  </div>
                  <div>
                    <select formControlName="result">
                      <option value="">N/A</option>
                      <option value="pass">Pass</option>
                      <option value="fail">Fail</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Confirmation -->
          <div class="form-section confirmation">
            <div class="form-field">
              <label>
                <input type="checkbox" formControlName="agreeTerms" required />
                I agree to &nbsp;
                <a href="link-to-test-guide" target="_blank">the test guide</a
                >,&nbsp;
                <a href="link-to-undertaking" target="_blank"
                  >the undertaking </a
                >, and &nbsp;
                <a href="link-to-affidavit" target="_blank"> the affidavit.</a>
                <span class="tooltip-icon" [matTooltip]="termsTooltip">?</span>
              </label>
              <span
                class="error-message"
                *ngIf="registrationForm.get('agreeTerms')?.hasError('required')"
              >
                You must agree to the terms
              </span>
            </div>
          </div>

          <div class="form-actions">
            <button type="button" class="back-button">Back</button>
            <!-- <button type="submit" class="submit-button" [disabled]="!registrationForm.valid">
                  Save & Continue
                </button> -->
            <button type="button" class="submit-button" (click)="onSubmit()">
              Save & Continue
            </button>
          </div>
        </form>
      </div>

      <!-- Upload Documents Phase -->
      <div
        *ngSwitchCase="'upload-documents'"
        class="phase-upload-documents document-upload"
      >
        <h2>Document Upload</h2>
        <p class="phase-description">
          Upload required documents for verification
        </p>
        <!-- Document upload content will go here -->
        <div class="upload-section">
          <!-- Photo Upload -->
          <div class="upload-card">
            <h3>
              <span class="english">Photograph</span>
            </h3>
            <div class="specifications">
              <h4>Specifications:</h4>
              <ul>
                <li>Clear background</li>
                <li>JPG/JPEG format only</li>
                <li>Max 50 KB file size</li>
                <li>Dimensions: 3.5cm × 4.5cm</li>
                <li>No selfies allowed</li>
              </ul>
            </div>
            <div
              class="upload-area"
              (click)="photoInput.click()"
              [class.has-file]="photoFile"
            >
              <input
                #photoInput
                type="file"
                accept=".jpg,.jpeg"
                (change)="onPhotoSelect($event)"
                hidden
              />
              <div *ngIf="!photoFile" class="upload-instructions">
                <mat-icon>add_a_photo</mat-icon>
                <p>Click to upload photograph</p>
              </div>
              <div *ngIf="photoFile" class="file-preview">
                <img
                  [src]="photoPreview"
                  alt="Photo preview"
                  class="preview-image"
                />
                <div class="file-info">
                  <span class="file-name">{{ photoFile.name }}</span>
                  <span class="file-size"
                    >{{ photoFile.size / 1024 | number : "1.0-0" }} KB</span
                  >
                  <span class="file-remove" (click)="removePhoto($event)"
                    >×</span
                  >
                </div>
              </div>
            </div>
            <div class="validation-message" [class.error]="photoError">
              {{ photoError || "&nbsp;" }}
            </div>
          </div>

          <!-- Signature Upload -->
          <div class="upload-card">
            <h3>
              <span class="english">Signature</span>
            </h3>
            <div class="specifications">
              <h4>Specifications:</h4>
              <ul>
                <li>Black ink on white background</li>
                <li>PNG format preferred</li>
                <li>Max 30 KB file size</li>
                <li>Dimensions: 6cm × 3cm</li>
                <li>Clear and legible</li>
              </ul>
            </div>
            <div
              class="upload-area"
              (click)="signatureInput.click()"
              [class.has-file]="signatureFile"
            >
              <input
                #signatureInput
                type="file"
                accept=".png,.jpg,.jpeg"
                (change)="onSignatureSelect($event)"
                hidden
              />
              <div *ngIf="!signatureFile" class="upload-instructions">
                <mat-icon>draw</mat-icon>
                <p>Click to upload signature</p>
              </div>
              <div *ngIf="signatureFile" class="file-preview">
                <img
                  [src]="signaturePreview"
                  alt="Signature preview"
                  class="preview-image"
                />
                <div class="file-info">
                  <span class="file-name">{{ signatureFile.name }}</span>
                  <span class="file-size"
                    >{{ signatureFile.size / 1024 | number : "1.0-0" }} KB</span
                  >
                  <span class="file-remove" (click)="removeSignature($event)"
                    >×</span
                  >
                </div>
              </div>
            </div>
            <div class="validation-message" [class.error]="signatureError">
              {{ signatureError || "&nbsp;" }}
            </div>
          </div>

          <!-- ID Proof Upload -->
          <div class="upload-card">
            <h3>
              <span class="english">ID Proof</span>
            </h3>
            <div class="specifications">
              <h4>Specifications:</h4>
              <ul>
                <li>Government-issued ID only</li>
                <li>PDF, JPG, or PNG format</li>
                <li>Max 500 KB file size</li>
                <li>Clear and readable</li>
                <li>Should match registration name</li>
              </ul>
            </div>
            <div
              class="upload-area"
              (click)="idProofInput.click()"
              [class.has-file]="idProofFile"
            >
              <input
                #idProofInput
                type="file"
                accept=".pdf,.jpg,.jpeg,.png"
                (change)="onIdProofSelect($event)"
                hidden
              />
              <div *ngIf="!idProofFile" class="upload-instructions">
                <mat-icon>badge</mat-icon>
                <p>Click to upload ID proof</p>
              </div>
              <div *ngIf="idProofFile" class="file-preview">
                <mat-icon *ngIf="isPdf(idProofFile)" class="file-icon"
                  >picture_as_pdf</mat-icon
                >
                <img
                  *ngIf="!isPdf(idProofFile)"
                  [src]="idProofPreview"
                  alt="ID proof preview"
                  class="preview-image"
                />
                <div class="file-info">
                  <span class="file-name">{{ idProofFile.name }}</span>
                  <span class="file-size"
                    >{{ idProofFile.size / 1024 | number : "1.0-0" }} KB</span
                  >
                  <span class="file-remove" (click)="removeIdProof($event)"
                    >×</span
                  >
                </div>
              </div>
            </div>
            <div class="validation-message" [class.error]="idProofError">
              {{ idProofError || "&nbsp;" }}
            </div>
          </div>
        </div>

        <div class="action-buttons">
          <button class="back-button" (click)="previousPhase()">Back</button>
          <!-- (click)="completePhase('upload-documents')" -->
          <button class="next-button" (click)="uploadPictures()">
            Upload & Continue
          </button>
        </div>

        <div class="errorClass" *ngIf="invalidUpload">
          Please upload all documents correctly before proceeding.
        </div>
      </div>

      <!-- Undertaking Phase -->
      <div *ngSwitchCase="'undertaking'" class="phase-undertaking">
        <h2>Undertaking and Affidavit</h2>
        <p class="phase-description">Please read and accept the terms</p>
        <!-- Undertaking content will go here -->
        <div class="legal-documents-container">
          <!-- Undertaking Section -->
          <div class="document-section undertaking">
            <h2 class="document-title">Undertaking</h2>
            <div class="document-content">
              <p class="document-text">
                I undersigned <b>{{ underTakingDetails.name }}</b> (Date of
                Birth <b>{{ underTakingDetails.dob }}</b
                >) living at - <i>{{ underTakingDetails.address }} </i>. As per
                the terms & conditions stated/given on JALTAP website regarding
                payment, refund & others, I confirm that all information
                provided is correct. I undertake full responsibility for all
                filled and given information.
              </p>

              <div class="signature-fields">
                <div class="signature-field">
                  <p>
                    Date: <b>{{ underTakingDetails.date }}</b>
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- Affidavit Section -->
          <div class="document-section affidavit">
            <h2 class="document-title">Affidavit</h2>
            <div class="document-content">
              <p class="document-text">
                I undersigned <b>{{ underTakingDetails.name }}</b> (Date of
                Birth <b>{{ underTakingDetails.dob }}</b
                >) living at - <i>{{ underTakingDetails.address }} </i> hereby
                solemnly affirm & declare as under:
              </p>

              <ol class="affidavit-points">
                <li>
                  I am a student of
                  {{ underTakingDetails.institution }} for N{{
                    underTakingDetails.testLevel
                  }}
                  (Level)
                </li>
                <li>
                  I will follow all rules & regulations of JALTAP as
                  communicated from time to time
                </li>
                <li>
                  As per the terms & conditions stated/given on JALTAP website
                  regarding payment, refund & others, I have read them carefully
                  and confirm all provided information is correct
                </li>
                <li>
                  I have fully understood that if any information given/filled
                  by me is incorrect, I will bear full responsibility for all
                  consequences and disciplinary actions
                </li>
              </ol>

              <div class="signature-fields">
                <div class="signature-field">
                  <p>
                    Date: <b>{{ underTakingDetails.date }}</b>
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- Declaration Checkbox -->
          <div class="declaration-check">
            <input
              type="checkbox"
              [(ngModel)]="agreeTermsUndertaking"
              required
            />
            I hereby declare that I have read and understood both the
            Undertaking and Affidavit, and I agree to abide by all terms and
            conditions mentioned above.
          </div>
        </div>
        <div class="action-buttons">
          <button class="back-button" (click)="previousPhase()">Back</button>
          <button class="next-button" (click)="acceptUndertakingForm()">
            Accept & Continue to Payment
          </button>
        </div>
        <div class="errorClass" *ngIf="!agreeTermsUndertaking">
          Please agree to the terms above.
        </div>
      </div>

      <!-- Payment Phase -->
      <div *ngSwitchCase="'payment'" class="phase-content phase-payment">
        <h2>Payment</h2>
        <p class="phase-description">Complete your registration payment.</p>

        <!-- Payment Instructions (Optional) -->
        <div class="payment-instructions" *ngIf="!paymentDone">
          <p>
            Please click the button below to proceed to payment of
            <b>₹{{ paymentAmt }} </b>. You will be redirected to Razorpay’s
            secure checkout.
          </p>
        </div>

        <div class="payment-instructions-done" *ngIf="paymentDone">
          <p>
            Payment of
            <b>₹{{ paymentAmt }} </b> is suceessful.
          </p>
        </div>

        <!-- Razorpay Button -->
        <div class="payment-section" *ngIf="!paymentDone">
          <button
            class="pay-now-button"
            (click)="makePayment()"
            [disabled]="paymentDone"
          >
            Pay Now
          </button>
        </div>

        <div class="action-buttons">
          <button class="back-button" (click)="previousPhase()">Back</button>
          <button class="next-button" (click)="completePhase('payment')">
            Proceed to Review
          </button>
        </div>
      </div>

      <!-- Review Phase -->
      <div class="review-section" *ngSwitchCase="'review'">
        <h2>Review Your Registration</h2>
        <p class="review-description">
          Please review all the information below before submitting your JLPT
          registration. If you need to make changes, click the "Back" button to
          edit your information.
        </p>

        <div class="review-content">
          <!-- Form Data Review -->
          <div class="form-review">
            <!-- Test Information -->
            <div class="review-section">
              <h3 class="section-title">
                <span class="english">Test Information</span>
                <span class="japanese">試験情報</span>
              </h3>
              <div class="review-field">
                <span class="field-label">Test Level:</span>
                <span class="field-value"
                  >N{{ registrationFormData.testLevel }}</span
                >
              </div>
              <div class="review-field">
                <span class="field-label">Time of Exam:</span>
                <span class="field-value">{{
                  registrationFormData.timeOfExam
                }}</span>
              </div>
            </div>

            <!-- Personal Details -->
            <div class="review-section">
              <h3 class="section-title">
                <span class="english">Personal Details</span>
                <span class="japanese">個人情報</span>
              </h3>
              <div class="review-field">
                <span class="field-label">Full Name:</span>
                <span class="field-value">
                  {{ registrationFormData.firstName }}
                  {{ registrationFormData.middleName }}
                  {{ registrationFormData.lastName }}
                </span>
              </div>
              <div class="review-field">
                <span class="field-label">SEQ:</span>
                <span class="field-value">{{
                  registrationFormData.regSeq
                }}</span>
              </div>
              <div class="review-field">
                <span class="field-label">Gender:</span>
                <span class="field-value">{{
                  registrationFormData.gender | titlecase
                }}</span>
              </div>
              <div class="review-field">
                <span class="field-label">Native Language:</span>
                <span class="field-value">{{
                  getLanguageName(registrationFormData.nativeLanguage)
                }}</span>
              </div>
              <div class="review-field">
                <span class="field-label">Date of Birth:</span>
                <span class="field-value">{{
                  registrationFormData.dob | date : "mediumDate"
                }}</span>
              </div>
              <div class="review-field">
                <span class="field-label">Passcode:</span>
                <span class="field-value">••••••••</span>
              </div>
            </div>

            <!-- Address -->
            <div class="review-section">
              <h3 class="section-title">
                <span class="english">Address</span>
                <span class="japanese">住所</span>
              </h3>
              <div class="review-field">
                <span class="field-label">House/Apt/Street:</span>
                <span class="field-value">{{
                  registrationFormData.address1
                }}</span>
              </div>
              <div class="review-field">
                <span class="field-label">City/State:</span>
                <span class="field-value">{{
                  registrationFormData.address2
                }}</span>
              </div>
              <div class="review-field">
                <span class="field-label">Country:</span>
                <span class="field-value">{{
                  registrationFormData.country
                }}</span>
              </div>
              <div class="review-field">
                <span class="field-label">Pincode:</span>
                <span class="field-value">{{
                  registrationFormData.pincode
                }}</span>
              </div>
            </div>

            <!-- Other Details -->
            <div class="review-section">
              <h3 class="section-title">
                <span class="english">Other Details</span>
                <span class="japanese">その他の詳細</span>
              </h3>
              <div class="review-field">
                <span class="field-label">Institution Studying Japanese:</span>
                <span class="field-value">{{
                  registrationFormData.institution
                }}</span>
              </div>
              <div class="review-field">
                <span class="field-label">Place of Learning Japanese:</span>
                <span class="field-value">{{
                  getLearningPlace(registrationFormData.learningPlace)
                }}</span>
              </div>
              <div class="review-field">
                <span class="field-label">Reason for Taking Exam:</span>
                <span class="field-value">{{
                  getExamReason(registrationFormData.examReason)
                }}</span>
              </div>
              <div class="review-field">
                <span class="field-label">Occupation:</span>
                <span class="field-value">{{
                  getOccupation(registrationFormData.occupation)
                }}</span>
              </div>
            </div>

            <!-- Media Contacts -->
            <div
              class="review-section"
              *ngIf="registrationFormData.mediaContacts?.length > 0"
            >
              <h3 class="section-title">
                <span class="english">Japanese Media Contact</span>
                <span class="japanese">日本語メディア接触</span>
              </h3>
              <div class="review-field">
                <span class="field-label">Media:</span>
                <span class="field-value">
                  <span
                    *ngFor="let media of registrationFormData.mediaContacts"
                  >
                    {{ getMediaContact(media) }}<br />
                  </span>
                </span>
              </div>
            </div>

            <!-- Communication -->
            <div class="review-section">
              <h3 class="section-title">
                <span class="english">Japanese Communication</span>
                <span class="japanese">日本語コミュニケーション</span>
              </h3>
              <div class="communication-review">
                <table>
                  <thead>
                    <tr>
                      <th>Person</th>
                      <th>Speaking</th>
                      <th>Listening</th>
                      <th>Reading</th>
                      <th>Writing</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>Teacher</td>
                      <td>
                        {{
                          registrationFormData.communication.teacher.speaking
                            ? "✓"
                            : ""
                        }}
                      </td>
                      <td>
                        {{
                          registrationFormData.communication.teacher.listening
                            ? "✓"
                            : ""
                        }}
                      </td>
                      <td>
                        {{
                          registrationFormData.communication.teacher.reading
                            ? "✓"
                            : ""
                        }}
                      </td>
                      <td>
                        {{
                          registrationFormData.communication.teacher.writing
                            ? "✓"
                            : ""
                        }}
                      </td>
                    </tr>
                    <tr>
                      <td>Family</td>
                      <td>
                        {{
                          registrationFormData.communication.family.speaking
                            ? "✓"
                            : ""
                        }}
                      </td>
                      <td>
                        {{
                          registrationFormData.communication.family.listening
                            ? "✓"
                            : ""
                        }}
                      </td>
                      <td>
                        {{
                          registrationFormData.communication.family.reading
                            ? "✓"
                            : ""
                        }}
                      </td>
                      <td>
                        {{
                          registrationFormData.communication.family.writing
                            ? "✓"
                            : ""
                        }}
                      </td>
                    </tr>
                    <tr>
                      <td>Friends</td>
                      <td>
                        {{
                          registrationFormData.communication.friends.speaking
                            ? "✓"
                            : ""
                        }}
                      </td>
                      <td>
                        {{
                          registrationFormData.communication.friends.listening
                            ? "✓"
                            : ""
                        }}
                      </td>
                      <td>
                        {{
                          registrationFormData.communication.friends.reading
                            ? "✓"
                            : ""
                        }}
                      </td>
                      <td>
                        {{
                          registrationFormData.communication.friends.writing
                            ? "✓"
                            : ""
                        }}
                      </td>
                    </tr>
                    <tr>
                      <td>Colleagues</td>
                      <td>
                        {{
                          registrationFormData.communication.colleagues.speaking
                            ? "✓"
                            : ""
                        }}
                      </td>
                      <td>
                        {{
                          registrationFormData.communication.colleagues
                            .listening
                            ? "✓"
                            : ""
                        }}
                      </td>
                      <td>
                        {{
                          registrationFormData.communication.colleagues.reading
                            ? "✓"
                            : ""
                        }}
                      </td>
                      <td>
                        {{
                          registrationFormData.communication.colleagues.writing
                            ? "✓"
                            : ""
                        }}
                      </td>
                    </tr>
                    <tr>
                      <td>Supervisor</td>
                      <td>
                        {{
                          registrationFormData.communication.supervisor.speaking
                            ? "✓"
                            : ""
                        }}
                      </td>
                      <td>
                        {{
                          registrationFormData.communication.supervisor
                            .listening
                            ? "✓"
                            : ""
                        }}
                      </td>
                      <td>
                        {{
                          registrationFormData.communication.supervisor.reading
                            ? "✓"
                            : ""
                        }}
                      </td>
                      <td>
                        {{
                          registrationFormData.communication.supervisor.writing
                            ? "✓"
                            : ""
                        }}
                      </td>
                    </tr>
                    <tr>
                      <td>Customers</td>
                      <td>
                        {{
                          registrationFormData.communication.customers.speaking
                            ? "✓"
                            : ""
                        }}
                      </td>
                      <td>
                        {{
                          registrationFormData.communication.customers.listening
                            ? "✓"
                            : ""
                        }}
                      </td>
                      <td>
                        {{
                          registrationFormData.communication.customers.reading
                            ? "✓"
                            : ""
                        }}
                      </td>
                      <td>
                        {{
                          registrationFormData.communication.customers.writing
                            ? "✓"
                            : ""
                        }}
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Previous Attempts -->
            <div class="review-section">
              <h3 class="section-title">
                <span class="english">Previous JLPT Attempts</span>
                <span class="japanese">以前のJLPT受験</span>
              </h3>
              <div class="attempts-review">
                <table>
                  <thead>
                    <tr>
                      <th>Level</th>
                      <th>Times Taken</th>
                      <th>Last Attempt Result</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let attempt of registrationFormData.attempts">
                      <td>N{{ attempt.level }}</td>
                      <td>{{ attempt.attempts }}</td>
                      <td>
                        {{
                          attempt.result
                            ? attempt.result === "pass"
                              ? "Pass"
                              : "Fail"
                            : "N/A"
                        }}
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Payment Information -->
            <div class="review-section">
              <h3 class="section-title">
                <span class="english">Payment Information</span>
                <span class="japanese">支払い情報</span>
              </h3>
              <div class="review-field">
                <span class="field-label">Amount:</span>
                <span class="field-value"
                  >₹{{ registrationFormData.paymentAmount }}</span
                >
              </div>
              <div class="review-field">
                <span class="field-label">Payment Date:</span>
                <span class="field-value">{{
                  registrationFormData.paymentDate | date : "medium"
                }}</span>
              </div>
            </div>

            <!-- Terms Confirmation -->
            <div class="review-section confirmation">
              <div class="review-field">
                <span class="field-label">Terms Accepted:</span>
                <span class="field-value">{{
                  registrationFormData.agreeTerms ? "Yes" : "No"
                }}</span>
              </div>
              <div
                class="review-field"
                *ngIf="registrationFormData.acceptUnderTakingAndAffidavit"
              >
                <span class="field-label">Undertaking Accepted:</span>
                <span class="field-value"
                  >Yes ({{
                    registrationFormData.underTakingAcceptDate
                      | date : "medium"
                  }})</span
                >
              </div>
            </div>
          </div>

          <!-- Document Previews -->
          <div class="document-previews">
            <h3 class="section-title">
              <span class="english">Document Uploads</span>
              <span class="japanese">アップロードされた文書</span>
            </h3>

            <div class="preview-grid">
              <div class="preview-item">
                <h4>Photograph</h4>
                <div class="preview-container">
                  <img
                    [src]="registrationFormData.uploadedDocuments.photo"
                    alt="Photograph Preview"
                    class="preview-image"
                  />
                </div>
              </div>

              <div class="preview-item">
                <h4>Signature</h4>
                <div class="preview-container">
                  <img
                    [src]="registrationFormData.uploadedDocuments.signature"
                    alt="Signature Preview"
                    class="preview-image"
                  />
                </div>
              </div>

              <div class="preview-item">
                <h4>ID Proof</h4>
                <div class="preview-container">
                  <img
                    [src]="registrationFormData.uploadedDocuments.id_proof"
                    alt="ID Proof Preview"
                    class="preview-image"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="review-actions">
          <button type="button" class="back-button" (click)="previousPhase()">Back to Edit</button>
          <button
            type="button"
            class="submit-button"
            (click)="submitRegistration()"
          >
            Submit Registration
          </button>
        </div>
      </div>
    </ng-container>
  </div>
</div>
